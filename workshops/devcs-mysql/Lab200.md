
# MYSQL Deployment using Infrastructure as Code

![](images/200/Title200.png) 

## Introduction

In this lab we introduce basic concepts of container deployed Microservices.  We will do this using Developer Cloud Service builds and deployments to the Application Container Cloud Service located in your Trial Account. Two microservices will be deployed. They are both Node.js applications. The RESTClient Node.js application communicates to a backend datasource, which in our case is the MYSQL database running as a Compute instance created in Lab 100. The second deployment is the `AlphaOffice UI` Node.js application which takes data from the `RESTClient` application.

***To log issues***, click here to go to the [github oracle](https://github.com/oracle/learning-library/issues/new) repository issue submission form.

## Objectives

- Build, Deploy and test a Microservices application (AlphaOffice)

### **STEP 1**: RESTClient Build and Deployment

- In Developer click on the **Project** link and in the Repositories section click **New Repository**.

![](images/200/1.PNG)

- In the dialog box enter:

```
RESTClient
```

- Select the **Import exsiting repository** radio button and enter OR **Cut and Paste**:

```
https://github.com/wvbirder/AlphaOfficeMYSQL-REST.git
```

  ![](images/200/2.PNG)

- Click **Create**

- The `RESTClient` application files are imported.

  ![](images/200/3.PNG)

- Click on the **server.js** file and then click on the **pencil icon** to edit. In the host section of the connection variable replace **host     : 'YOUR-IPADDR-HERE',** with the Public IP Address you obtained from the MYSQL Compute Instance.

Example:

**This**:     host     : 'YOUR-IPADDR-HERE',

**Becomes**:      host     : '129.213.137.223',

  ![](images/200/3-2.PNG)

- Click the **Commit** button on the edit page and the pop up dialog.

- Click on the project **Build** link and select **New Job**.

  ![](images/200/4.PNG)

-  Enter the following for Job Name:

```
AlphaOffice-RESTClient
```

- Select the **PackerTerraformNodeJS** Software Template and click **Create Job**.

  ![](images/200/5.PNG)

- In the **Source Control** tab select **Add Source Control-->Git**.

  ![](images/200/6.PNG)

- In the Git dialog select the **RESTClient.git** repository and check the **Automatically perform build based on SCM commit** checkbox. This means any changes to the files within the repository will fire off a new build.

  ![](images/200/7.PNG)

- Select the **Builders** tab and in the Add Builder drop down choose **Unix Shell Builder**.

  ![](images/200/8.PNG)

- Enter the following Script command:

```
npm install
```

  ![](images/200/10.PNG)

- Select the **Post Build** tab and from the Add Post Build Action choose **Artifact Archiver**. 


  ![](images/200/11.PNG)

- In the Files to Archive field enter:

```
**/target/*
```
  ![](images/200/12.PNG)

- Click the **Save** button.

- Click the **Build Now** button. The job is queue for execution.

  ![](images/200/13.PNG)

  ![](images/200/14.PNG)

  - The build should complete within a few minutes time. Clicking on the **Build Log** icon will show a bundled up .zip file was created.

  ![](images/200/15.PNG)

  ![](images/200/16.PNG)

  ![](images/200/17.PNG)

- Now create a Deployment job. Click the project **Deploy** link and select **New Configuration**.

   ![](images/200/18.PNG)

  ![](images/200/19.PNG)

- Enter the following:

```
Configuration Name: AlphaOffice-RESTClient-Deploy
Application Name: AlphaOfficeREST
```

- Then select from the Deployment Target field, **New-->Application Container Cloud**.

  ![](images/200/20.PNG)

- The Application Container Cloud dialog requires an Identity Domain entry. To obtain this entry go to the main Dashboard and click on the Identity Cloud Service **hamburger menu**, right-click on **View Details** and select **Open link in new tab**.  

  ![](images/200/21.PNG)

- The Service ID we need is in the Additional Information section. Cut and Paste the **Identity Service Id** and put it into the Developer Deployment dialog `Identity Domain` field.

  ![](images/200/22.PNG)

- Finish off the dialog by selecting 

    - Datacenter: **us1** OR **us2**

... and enter your Trial Account **Username** and **Password**. Click the **Test Connection** button.

  ![](images/200/23.PNG)

- It may take a minute or so the first time but the connection should be successfull. Click **Use Connection**.

  ![](images/200/24.PNG)

- Finish off the New Connection dialog by setting the following properties:

    - **Runtime**: NODE
    - **Subscription**: Hourly
    - **Type**: Automatic (Stable builds only)
    - **Job**: AlphaOffice-RESTClient
    - **Artifact**: target/msdbw-mysqlmicroservice.zip
    - **Include ACCS Deployment**:

- The folowing text block goes into ACCS Deployment:

    ```
    {
    "memory": "1G",
    "instances": "1"
    }
    ```
- Click **Save**.

  ![](images/200/25.PNG)

- The `AlphaOfficeREST` deployment will be displayed. Select **Start** from the drop down actions menu. If prompted, click **Deploy**.

  ![](images/200/26.PNG)

**NOTE:** The build field stipulates which build to use for the deployment.

- **The deployment connects to the Application Container Cloud Service in your Trial Account and deploys the application into a container** (Docker in this case). It may be several minutes before it is completed.

- Example screen shot of a Redeploy

![](images/200/27.PNG)

- **NOTE: If you get an error on the first Start or Deployment do a Redeploy**.

  ![](images/200/27-2.PNG)

  ![](images/200/27-4.PNG)

- The action menu can also Stop or Start a container:

  ![](images/200/27-6.PNG)

- You can check the deployment inside the Application Container Cloud Service Console by going to the main Dashboard and clicking on the Application Container **hamburger menu**, right-clicking on **Open Service Console** and selecting **Open link in new tab**.
  
  ![](images/200/28.PNG)

  ![](images/200/28-2.PNG)

- Back in the Developer's **Deploy** screen right-click on the `AlphaOfficeREST` deployment and select **Open link in new tab**. It will show the RESTClient application.

  ![](images/200/29.PNG)

  ![](images/200/30.PNG)

- Add the following suffix to the application URL:

```
/products
```

- If your browser has a JSON formatting add-on you'll see data returned from the MYSQL database in JSON format, else you'll see a large text string. In ether case your RESTClient is connected to the MYSQL AlphaOffice schema and querying data.

  ![](images/200/31.PNG)

- Now change the the URL to query one product. Change the URL to:

```
/product/1025
```

 **NOTE:** (Product is singular in this case)

- You should see:

  ![](images/200/32.PNG)

### **STEP 2**: AlphaOffice UI Build and Deployment

In this step you will build and deploy the AlphaOffice UI Node.js application. It follows the same steps as we did in Step 1.

- Click on the **Project** link and in the Repositories section click **New Repository**.

![](images/200/1.PNG)

- In the dialog box enter:

```
AlphaOfficeUI
```

- Select the **Import exsiting repository** radio button and enter OR **Cut and Paste**:

```
https://github.com/wvbirder/ProductCatalogUI.git
```

  ![](images/200/33.PNG)

- Click **Create**

- The `AlphaOfficeUI` application files are imported.

  ![](images/200/34.PNG)

- **Navigate to public-->js**. Click on the **AlphaOffice.js** file. You are going to change the **dbServiceURL** variable and replace the **localhost:8002** portion of the string with the URL of the newly deployed `RESTClient` Application. To obtain that URL click on the project **Deploy** link and right-click on the **AlphaOfficeREST** link and select **Copy link address**. 

  ![](images/200/35.PNG)

- Once copied go back to the Code `AlphaOfficeUI.git` repository and replace the current string with the copied URL. **Navigate to public-->js**. Click on the **AlphaOffice.js** file and then click on the **pencil icon** to edit. You can use CTRL-V to paste the string into the file.

Example:

**This**: "http://localhost:8002/products";

**Becomes**: "https://alphaofficerest-oraclestartupecosystem.uscom-central-1.oraclecloud.com/products";

**NOTE: Remember to keep the `/products` portion of the URL.**

  ![](images/200/36.PNG)

- Click the **Commit** button on the edit page and in the pop up dialog.

- Click on the project **Build** link and select **New Job**.

  ![](images/200/4.PNG)

-  Enter the following for Job Name:

```
AlphaOfficeUI
```

- Select the **PackerTerraformNodeJS** Software Template and click **Create Job**.

  ![](images/200/37.PNG)

- In the **Source Control** tab select **Add Source Control-->Git**.

  ![](images/200/6.PNG)

- In the Git dialog select the **AlphaOfficeUI.git** repository and check the **Automatically perform build based on SCM commit** checkbox. This means any change changes to the files within the repository will fire off a new build.

  ![](images/200/38.PNG)

- Select the **Builders** tab and in the Add Builder drop down choose **Unix Shell Builder**.

  ![](images/200/8.PNG)

- Enter the following Script command:

```
npm install
```

  ![](images/200/10.PNG)

- Select the **Post Build** tab and from the Add Post Build Action choose **Artifact Archiver**. 


  ![](images/200/11.PNG)

- In the Files to Archive field enter:

```
**/target/*
```
  ![](images/200/12.PNG)

- Click the **Save** button.

- Click the **Build Now** button. The job is queue for execution.

  ![](images/200/13.PNG)

  ![](images/200/14.PNG)

  - The build should complete within a few minutes time. Clicking on the **Build Log** icon will show a bundled .zip file.

  ![](images/200/15.PNG)

  ![](images/200/16.PNG)

  ![](images/200/39.PNG)

- Now create a Deployment job. Click the project **Deploy** link and select **New Configuration**.

   ![](images/200/18.PNG)

  ![](images/200/19.PNG)

- Enter the following:

```
Configuration Name: AlphaOfficeUI-Deploy
Application Name: AlphaOfficeUI
```

- Then in the Deployment Target field **re-use** the target connection you created in the RESTClient deployment.

  ![](images/200/40.PNG)

- Finish off the dialog by entering your Trial Account **Username** and **Password**. Click the **Test Connection** button.

  ![](images/200/23.PNG)

- The connection should be successfull. Click **Use Connection**.

  ![](images/200/24.PNG)

- Finish off the New Connection dialog by setting the following properties:

    - **Runtime**: NODE
    - **Subscription**: Hourly
    - **Type**: Automatic (Stable builds only)
    - **Job**: AlphaOfficeUI
    - **Artifact**: target/msdbw-microserviceui.zip
    - **Include ACCS Deployment**:


- The folowing text block goes into ACCS Deployment:

    ```
    {
    "memory": "1G",
    "instances": "1"
    }
    ```
- Click **Save**.

  ![](images/200/41.PNG)

- The `AlphaOfficeUI` deployment will be displayed. Select **Start** from the drop down actions menu. If prompted, click **Deploy**.

  ![](images/200/42.PNG)

**NOTE:** The build field stipulates which build to use for the deployment.

- **The deployment connects to the Application Container Cloud Service in your Trial Account and attempts to deploy the application into a container** (Docker in this case). It may be several minutes before it is completed.

- Example screen shot of a Redeploy

![](images/200/43.PNG)

- **NOTE: If you get an error on the first Start or Deployment do a Redeploy**. (example shown)

  ![](images/200/27-2.PNG)

  ![](images/200/27-4.PNG)

- Deployment should be successful:

  ![](images/200/44.PNG)

- You can check the deployment inside the Application Container Cloud Service Console by going to the main Dashboard and clicking on the Application Container **hamburger menu**, right-clicking on **Open Service Console** and selecting **Open link in new tab**.
  
  ![](images/200/28.PNG)

  ![](images/200/45.PNG)

- Back in the Developer project Deploy screen right-click on the `AlphaOfficeUI` deployment and select **Open link in new tab**. It should show the AlphaOffice application displaying the Product Catalog obtained from the MYSQL database.

  ![](images/200/46.PNG)

  ![](images/200/47.PNG)

**This completes the Lab, you can continue to Lab 300**
